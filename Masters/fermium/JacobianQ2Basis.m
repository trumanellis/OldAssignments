function Jmat=JacobianQ2Basis(nodes,localPt)

X1=nodes(:,1)';
X2=nodes(:,2)';
X3=nodes(:,3)';
X4=nodes(:,4)';
X5=nodes(:,5)';
X6=nodes(:,6)';
X7=nodes(:,7)';
X8=nodes(:,8)';
X9=nodes(:,9)';
x=localPt(1);
y=localPt(2);

% Jmat=[-X2 - 3*X1 + 4*X5 + x*(-8*X5 + 4*X1 + 4*X2 - 32*X9*y - 12*X1*y ...
%     - 12*X2*y - 4*X3*y - 4*X4*y + 8*X7*y + 16*X6*y + 16*X8*y + 24*X5*y ...
%     - 16*X5*y*y - 16*X6*y*y - 16*X7*y*y - 16*X8*y*y + 8*X1*y*y ...
%     + 8*X2*y*y + 8*X3*y*y + 8*X4*y*y + 32*X9*y*y) ...
%     + y*(X3 - 12*X5 - 12*X8 - 4*X6 - 4*X7 + 3*X2 + 3*X4 + 9*X1 + 16*X9) ...
%     + y*y*(-16*X9 - 6*X1 - 6*X4 - 2*X2 - 2*X3 + 4*X6 + 8*X5 + 8*X7 + 12*X8);
%     -X4 - 3*X1 + 4*X8 + x*(X3 - 12*X5 - 12*X8 - 4*X6 - 4*X7 + 3*X2 ...
%     + 3*X4 + 9*X1 + 16*X9 - 32*X9*y - 12*X1*y - 12*X4*y - 4*X2*y ...
%     - 4*X3*y + 8*X6*y + 16*X5*y + 16*X7*y + 24*X8*y) ...
%     + y*(-8*X8 + 4*X1 + 4*X4) + x*x*(-16*X9 - 6*X1 - 6*X2 - 2*X3 ...
%     - 2*X4 + 4*X7 + 8*X6 + 8*X8 + 12*X5 - 16*X5*y - 16*X6*y - 16*X7*y ...
%     - 16*X8*y + 8*X1*y + 8*X2*y + 8*X3*y + 8*X4*y + 32*X9*y)];



%  Jmat=[((y - 1)*(-4*(2*y - 1)*(2*x - 1)*X5 + (2*y - 1)*(4*x - 3)*X1 ...
%      + (2*y - 1)*(4*x - 1)*X2 + 16*(2*x - 1)*X9*y ...
%      - 4*(4*x- 3)*X8*y - 4*(4*x - 1)*X6*y) ...
%      + y*(-4*(2*y - 1)*(2*x - 1)*X7 + (2*y- 1)*(4*x - 3)*X4 ...
%      + (2*y - 1)*(4*x - 1)*X3));
%      (-4*(2*y - 1)*(x - 1)*(2*x - 1)*X8 + 16*(2*y - 1)*(x - 1)*X9*x ...
%      - 4*(2*y -1)*(2*x - 1)*X6*x + (4*y - 3)*(x - 1)*(2*x - 1)*X1 ...
%      - 4*(4*y - 3)*(x -1)*X5*x + (4*y - 3)*(2*x - 1)*X2*x ...
%      + (4*y - 1)*(x - 1)*(2*x - 1)*X4 -4*(4*y - 1)*(x - 1)*X7*x ...
%      + (4*y - 1)*(2*x - 1)*X3*x)];
    
    Jmat=[(-4*(y - 1)*(2*y - 1)*(2*x - 1)*X5 + (y - 1)*(2*y - 1)*(4*x - 3)*X1 ...
    + (y- 1)*(2*y - 1)*(4*x - 1)*X2 + 16*(y - 1)*(2*x - 1)*X9*y ...
    - 4*(y - 1)*(4*x- 3)*X8*y - 4*(y - 1)*(4*x - 1)*X6*y ...
    - 4*(2*y - 1)*(2*x - 1)*X7*y + (2*y- 1)*(4*x - 3)*X4*y ...
    + (2*y - 1)*(4*x - 1)*X3*y);
    (-4*(2*y - 1)*(x - 1)*(2*x - 1)*X8 + 16*(2*y - 1)*(x - 1)*X9*x ...
    - 4*(2*y -1)*(2*x - 1)*X6*x + (4*y - 3)*(x - 1)*(2*x - 1)*X1 ...
    - 4*(4*y - 3)*(x -1)*X5*x + (4*y - 3)*(2*x - 1)*X2*x ...
    + (4*y - 1)*(x - 1)*(2*x - 1)*X4 -4*(4*y - 1)*(x - 1)*X7*x ...
    + (4*y - 1)*(2*x - 1)*X3*x)];